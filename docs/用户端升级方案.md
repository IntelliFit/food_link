这份需求文档专注于 **Food Link** 用户端（面向普通用户）的功能升级与优化方案，旨在通过引入更先进的模型（Gemini 3）、深度的个性化健康档案以及专业级的营养分析（宏量比例、吸收率等），构建具有竞争力的饮食生态系统。

---

# Food Link 用户端功能升级需求文档 (V1.0)

## 1. 核心模型升级：多模型路由 (OpenRouter)

为了对比并获取最佳分析效果，系统将从单一的通义千问模型转向多模型支撑架构。

* **Gemini 3 Flash Preview 集成**：通过 OpenRouter 接入 Gemini 3 Flash Preview 模型。利用其强大的多模态处理能力和极速响应，提升食物识别的准确度。
* **模型切换引擎**：后端需支持动态模型路由，以便根据任务类型或用户权限在不同模型间进行切换。

## 2. 深度个性化健康档案 (Professional Onboarding)

建立完善的用户画像，使饮食建议从“通用型”转变为“干预型”。

* **基础生理指标问卷**：用户首次登录需填写性别、年龄、身高、体重及日常活动水平 (PAL)。
* **代谢计算引擎**：后端根据用户信息自动计算基础代谢率 (BMR) 及每日总能量消耗 (TDEE)，为饮食计划设定基准线。
* **医疗与健康背景**：
* **快速导入**：支持通过 OCR 识别技术上传体检报告或病例截图（利用 Gemini 3 的多模态能力）。
* **手动声明**：支持勾选既往病史（如糖尿病、高血压、痛风等）或特殊饮食习惯（如生酮、素食）。



## 3. 专业级营养分析与建议 (Pro Nutrition Analysis)

在现有热量、蛋白质、碳水、脂肪分析基础上，提升专业维度：

* **宏量营养素比例 (PFC Ratio)**：根据用户的目标（增肌/减脂/维持），动态分析每一餐的蛋白质 (P)、脂肪 (F)、碳水 (C) 占比是否符合科学比例。
* **吸收率与生物利用度分析**：AI 分析时需考虑食物组合对吸收的影响（例如：维生素 C 促进铁吸收，或特定烹饪方式对蛋白质利用率的影响），体现专业深度。
* **情境感知建议 (Context-Aware Advice)**：
* 结合用户当前状态（如“刚健身完”）给出针对性补剂或进食建议。
* 结合当日剩余热量预算，智能推荐下一餐的成分构成。



## 4. 饮食记录与数据持久化 (Recording & Tracking)

目前的记录仅停留在前端缓存，需实现完整的数据库持久化：

* **热量盈缺看板**：可视化展示最近一周或一月的摄入热量与 TDEE 的差值，直观反映进度。
* **坚持机制 (Streak)**：引入“健康饮食连续天数”统计，通过勋章或成就系统激励用户保持习惯。
* **记录回顾**：支持查看历史每一餐的图片、AI 评分及当时的分析结论。

## 5. 食物生态与社区功能 (Recipe & Community)

* **私人食谱库**：支持用户将常吃的组合（如“我的标配减脂早餐”）保存为食谱，实现一键记录，无需重复拍照分析。
* **公共食谱广场**：用户可将优秀的减脂/增肌食谱上传至公共广场，供其他用户学习、收藏和直接引用，构建互助生态。
* **社交连接**：支持添加好友功能，可查看好友的公开饮食动态，实现社交监督与动力共享。

## 6. 高社交属性分享体系 (Social Sharing)

* **精致分享卡片**：
* **视觉优化**：自动对食物照片进行美化处理，生成带有品牌水印和专业营养参数浮层的海报。
* **核心指标展示**：海报上不仅有照片，还应包含“健康指数评分”、“本周累计达成”等具有成就感的统计数据。


* **历程分享**：支持生成“我在 Food Link 坚持健康饮食第 X 天”的长图或视频预览。

## 7. 数据库表结构调整 (后端相关)

为了支撑上述功能，`weapp_user` 表需扩展以下字段：

* `height`, `weight`, `birthday`, `gender`, `activity_level` (生理指标)。
* `health_condition` (JSON 格式存储病史及过敏源)。
* `bmr`, `tdee` (计算结果)。
* **新增表**：`recipes` (食谱表), `dietary_logs` (饮食流水记录表), `user_friends` (社交关系表)。

---

**总结**：本方案通过 OpenRouter 接入 **Gemini 3** 获取更精准的解析能力，并通过**专业营养维度（吸收率、PFC 比例）**与**深度个性化背景**的结合，将 Food Link 从一个简单的“拍照识别工具”升级为用户的“专业私人 AI 营养师”。