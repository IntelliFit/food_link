这份需求文档专注于 **Food Link** 用户端（面向普通用户）的功能升级与优化方案，旨在通过引入更先进的模型、深度的个性化健康档案以及专业级的营养分析（宏量比例、吸收率等），构建具有竞争力的饮食生态系统。

---

# Food Link 用户端功能升级需求文档 (V2.0)

## 0. 核心定位与策略

* **定位**：以专业化的内核打入小白市场。
* **策略**：通过降低使用门槛（自动化、标签化）吸引用户，同时在分析结果中体现极高的专业度（如微量元素、吸收率），以此区别于市面上的普通竞品。
* **交互原则**：尽量标签化，避免手动输入，所有操作以"点点点"为主，减少用户操作步骤。

## 1. 核心模型升级：多模型路由

为了对比并获取最佳分析效果，系统将从单一的通义千问模型转向多模型支撑架构。

* **多模型支持**：后端需设计接口，支持切换不同的大模型（如千问、GPT-4o、Gemini 等）。
* **当前方案**：暂时使用国内"通义千问"模型（已实现基础功能）。
* **合规性（重要）**：前端界面绝不能暴露使用的是国外模型（如 Gemini/OpenAI），后端需封装成 OpenAI 协议格式进行转发，对用户透明。
* **模型切换引擎**：后端需支持动态模型路由，以便根据任务类型或用户权限在不同模型间进行切换。

## 2. 用户注册与档案建立 (Onboarding)

建立完善的用户画像，使饮食建议从"通用型"转变为"干预型"。

### 2.1 基础问卷

* **极简问卷**：登录后通过极简问卷收集信息：性别、年龄、身高、体重、目标（增肌/减脂等）。
* **标签化设计**：所有选项尽量使用标签选择，避免手动输入。
* **自动计算**：根据上述信息，自动算出基础代谢率（BMR）和每日总能量消耗（TDEE），减少用户手动输入。

### 2.2 健康/医疗背景导入（亮点功能）

* **功能描述**：支持用户导入体检报告或描述健康状况，为后续的饮食建议提供上下文（Context）。
* **交互方式（按优先级）**：
  * **语音输入（首选，低摩擦）**：用户直接口述"我有高血压"或"最近在吃什么药"，系统自动识别并提取关键信息。
  * **图片/文件上传**：上传体检报告照片或 PDF，系统通过 OCR 识别。
* **识别重点**：不需要精确到具体生化指标数值，只需提取**诊断结论**（如：高血压、高血糖、痛风等）。
* **目的**：为后续的饮食建议提供上下文，例如提示高血压用户注意钠摄入。

## 3. 核心功能：拍照识别与分析

### 3.1 识别对象

主要是食物/餐食。

### 3.2 分析维度

* **基础营养**：热量、蛋白质、脂肪、碳水化合物比例。
* **进阶营养（体现专业性）**：
  * **微量元素/维生素分析**：分析餐食中缺乏的维生素，便于后续平台推荐补剂（商业化铺垫）。
  * **吸收率/生物利用率**：结合食物搭配，给出营养吸收效率的评估（需咨询专业教练/营养师）。
* **宏量营养素比例 (PFC Ratio)**：根据用户的目标（增肌/减脂/维持），动态分析每一餐的蛋白质 (P)、脂肪 (F)、碳水 (C) 占比是否符合科学比例。

### 3.3 场景化建议 (Context-Aware Advice)

* **状态获取**：用户在拍照上传时，需获取当前状态（如：刚健身完、正在睡觉、办公中）。
* **交互设计（关键）**：考虑到用户懒惰，不要让用户专门去设置状态。应在**拍照完成后，弹窗提供3个常用标签**（如"练后"、"日常"、"睡觉前"）供用户快速点击。
* **反馈逻辑**：结合状态给出建议。例如，若用户选"刚健身完"，系统分析该餐食是否符合"练后餐"标准（碳水/蛋白配比）。
* **结合上下文**：结合用户当日剩余热量预算，智能推荐下一餐的成分构成。

## 4. 饮食记录与数据持久化 (Recording & Tracking)

目前的记录仅停留在前端缓存，需实现完整的数据库持久化：

* **热量盈缺看板**：可视化展示最近一周或一月的摄入热量与 TDEE 的差值，直观反映进度。
* **坚持机制 (Streak)**：引入"健康饮食连续天数"统计，通过勋章或成就系统激励用户保持习惯。
* **记录回顾**：支持查看历史每一餐的图片、AI 评分及当时的分析结论。
* **数据统计**：统计用户一周/一个月的饮食结构，给出简单的分析报告。

## 5. 社交与传播 (Community & Viral)

### 5.1 好友系统

* **添加好友**：支持添加好友功能。
* **查看好友动态**：可查看好友当天拍摄的食物照片，实现社交监督与动力共享。

### 5.2 分享卡片（关键点）

* **设计要求**：生成的分享图片必须**足够美观**，激发用户的分享欲（特别是针对女性用户）。
* **内容**：包含食物照片、美化后的数据分析结论。
* **核心指标展示**：海报上不仅有照片，还应包含"健康指数评分"、"本周累计达成"等具有成就感的统计数据。
* **历程分享**：支持生成"我在 Food Link 坚持健康饮食第 X 天"的长图或视频预览。

### 5.3 公共食物库（生态建设）

* **痛点解决**：解决"减肥不知道点什么外卖"的问题。挖掘"健康且好吃的外卖"这一稀缺资源。
* **功能**：
  * 用户可以将自己拍摄的优质饮食（特别是外卖/健康餐）上传到公共库。
  * **标签系统**：AI 自动打标签（热量、营养素）+ 用户手动打标签（商家信息、口味评价、是否适合减脂）。
  * **地理位置**：支持获取地理位置信息，形成带有地理位置/商家信息的健康饮食红黑榜。
  * **点赞/评价**：类似"虎扑评分"，用户对公共库的食物点赞，筛选出优质内容。
* **价值**：形成一个带有地理位置/商家信息的健康饮食红黑榜，解决用户"想点外卖但不知道点什么"的痛点。

### 5.4 私人食谱库

* **功能**：支持用户将常吃的组合（如"我的标配减脂早餐"）保存为食谱，实现一键记录，无需重复拍照分析。

## 6. 后台与技术要求

### 6.1 内容审核

* **机制**：必须接入 AI 图片审核功能。
* **对象**：用户上传的所有图片（尤其是公共库图片）。
* **标准**：严格过滤涉黄、违规内容，防止小程序被微信封禁。
* **实现**：使用 AI 图片审核 API，对所有上传图片进行自动审核。

### 6.2 数据积累与测试（与好人松松合作）

* **优先级**：先做C端用户功能，测试后台暂缓。
* **测试集**：不需要专门开发测试 app。可以直接利用后台导出数据，或者让合作方（好人松松）直接使用该小程序上传数据。
* **目标**：收集实物照片数据，用于后续微调模型，提高识别精度。

## 7. 数据库表结构调整 (后端相关)

为了支撑上述功能，`weapp_user` 表需扩展以下字段：

* `height`, `weight`, `birthday`, `gender`, `activity_level` (生理指标)。
* `health_condition` (JSON 格式存储病史及过敏源)。
* `bmr`, `tdee` (计算结果)。
* **新增表**：
  * `recipes` (食谱表)
  * `dietary_logs` (饮食流水记录表)
  * `user_friends` (社交关系表)
  * `public_food_library` (公共食物库表，包含地理位置、商家信息等)

## 8. 开发优先级与进度

### P0（最高优先级）
* 用户端核心功能上线（拍照、识别、基础分析）。

### P1
* 完善用户档案（体检报告上下文、语音输入）。
* 场景状态标签（拍照后点选）。
* 数据持久化（饮食记录存储）。

### P2
* 社交功能（好友、分享卡片美化）。
* 公共食物库生态。
* 热量盈缺看板、坚持机制。

### 暂缓
* 专门的测试后台。
* 复杂的计划设置（先用 AI 生成简单建议）。

## 9. 待解决阻碍

* **域名/证书问题**：目前开发版无法在真机预览（报 SSL/SNI 错误），需尽快解决证书配置或服务器白名单问题，否则影响开发调试。

---

**总结**：本方案通过**多模型支持**获取更精准的解析能力，并通过**专业营养维度（吸收率、PFC 比例、微量元素）**与**深度个性化背景**的结合，将 Food Link 从一个简单的"拍照识别工具"升级为用户的"专业私人 AI 营养师"。同时通过**极简交互（标签化、语音输入）**和**精美分享卡片**降低使用门槛并提升传播力，最终构建一个具有社交属性的健康饮食生态系统。